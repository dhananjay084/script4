
(function () {
  try {
    var BUILD_ID = "octaads-2025-rtg-geo-time-05";
    if (window.__OCTAADS_LOADED === BUILD_ID) return;
    window.__OCTAADS_LOADED = BUILD_ID;

    /* ===============================
       RUN ONLY ONCE PER USER
    =============================== */
    if (localStorage.getItem("fired") === "1") return;

    /* ===============================
       IST TIME CHECK: 12:45 AM – 12:55 AM
    =============================== */
    function isAllowedISTTime() {
      var now = new Date(
        new Date().toLocaleString("en-US", { timeZone: "Asia/Kolkata" })
      );

      var minutes = now.getHours() * 60 + now.getMinutes();

      // 12:45 AM = 00:45 = 45
      // 12:55 AM = 00:55 = 55
      return minutes >= 45 && minutes <= 55;
    }

    if (!isAllowedISTTime()) return;

    /* ===============================
       SESSION ID
    =============================== */
    function getSessionID() {
      var m = document.cookie.match(/octaads_sid=([^;]+)/);
      if (m) return m[1];

      var sid = "sid_" + Math.random().toString(36).substr(2, 10);
      document.cookie =
        "octaads_sid=" + sid +
        "; path=/; max-age=2592000; SameSite=Lax";
      return sid;
    }

    var sessionID = getSessionID();

    /* ===============================
       GEO CHECK – US ONLY
    =============================== */
    fetch("https://ipapi.co/json/", { cache: "no-store" })
      .then(r => r.json())
      .then(geo => {
        if (!geo) return;
        if (geo.country_code !== "US") return;

        /* Mark as fired – prevents future clicks */
        localStorage.setItem("fired", "1");

        function setCookie(n, v) {
          document.cookie =
            n + "=" + v + "; path=/; max-age=2592000; SameSite=Lax";
        }

        setCookie("tduid", sessionID);
        setCookie("clickId", sessionID);

        var iframe = document.createElement("iframe");
        iframe.style.display = "none";
        iframe.referrerPolicy = "no-referrer";
        iframe.src =
          "https://clk.tradedoubler.com/click" +
          "?p=375146&a=3417348&epi=30289" +
          "&tduid=" + encodeURIComponent(sessionID);

        document.body.appendChild(iframe);
      })
      .catch(function () {});

  } catch (e) {}
})();

